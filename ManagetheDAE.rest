.. _ManagetheDAE:

Manage the DAE
==============

The Data Acquisition Electronics (DAE) is the hardware which collects neutron or muon data. The DAE is controlled by the ICP (see [[Key Concepts in IBEX|KeyConceptsinIBEX]]), which informs the DAE when to start and stop collecting data from the instrument detectors. The ICP also receives sample environment information and combines it with the detector data and is responsible for transferring the final combined dataset to a data file.

The DAE view communicates with the ICP to control the DAE. The view is split into a number of tabs and sub tabs.

Contents
--------

#. `Run Summary`_
#. `Experiment Setup`_

   #. `Time Channels`_
   #. `Data Acquisition`_
   #. `Periods`_

#. `Run Information`_
#. `Spectra Plots`_
#. `Diagnostics`_
#. `Vetoes`_

Run Summary
-----------

The Run Summary tab displays some summary information about the current run and displays any log messages received from the ICP. 

Run Summary Fields
~~~~~~~~~~~~~~~~~~

* ``Instrument``: records the instrument on which the current run is being performed
* ``Run Status``: records status of the current run
* ``Run Number``: records the current run number
* ``ISIS Cycle``: records the current ISIS cycle
* ``Title``: you can provide a short description of the current run in the ``Title`` field.  Click on the ``Set`` button to commit the change (i.e. send it to the ICP, so that it gets included in the data file).
* ``Show Title in Dataweb Dashboard Page``: set whether to display the title in the Dataweb dashboard.  This checkbox only affects the Dataweb dashboard; it does not affect display of the title in IBEX, or the inclusion of the title in the data file.

Return to `Contents`_.

Message Log
~~~~~~~~~~~
The message log area lets you view any messages issued by the ICP.  The message log area is the same as the main Log Messages view but filtered to show only messages from the ICP.

The Run Summary tab also provides a number of buttons to control the acquisition of data.

Begin Run:
   Beginning a run instructs the ICP to tell the DAE to start collecting data. The DAE’s run status will change to BEGINNING and then RUNNING; this is displayed in the ``Run Status`` field and in the IBEX [[Dashboard]].

End Run:
   Ending a run instructs the ICP to tell the DAE to stop collecting data and save the data. The DAE’s run status will change to ENDING (while it saves the data) and then SETUP when it is ready to be started again.

Pause Run:
   Pausing a run instructs the ICP to tell the DAE to pause data collection indefinitely. The DAE’s run status will change to PAUSED.  The DAE's status will remain PAUSED until it is instructed to resume, end or abort the run.

Resume Run:
   Resuming a run instructs the ICP to tell the DAE to resume data collection after it has been paused. The DAE’s run status will return to RUNNING.

Abort Run:
   Aborting a run instructs the ICP to tell the DAE to stop data collection (as for END).  However, the data that has been collected is not written to a file; if a new run is started, then any data that has been collected will be lost. The DAE’s run status will change to SETUP. If this is done mistakenly the cancel abort button can be used to undo the abort.

Cancel Abort:
   This will instruct the DAE to cancel a previous abort. The DAE will be left in a paused state.

Save Run: 
   Click on the ``SAVE RUN`` button to save the current run data without stopping the current run.

Return to `Contents`_.


Experiment Setup
----------------

The Experiment Setup comprises three sub-tabs.  Each of these 3 sub-tabs will have been configured by an ISIS Instrument Scientist.  Please do not modify the contents of these 3 tabs without consulting with the instrument scientist. 

Any changes made are only sent to the DAE when the ``Apply Changes`` button is pressed. If there is a problem with the setting an error message will appear on the `Run Summary`_ panel.

Time Channels
~~~~~~~~~~~~~

The time channels tab allows the setting of the spectra captured in different time regimes. By setting different step sizes and modes you can optimise the sizes of the time bins in the final spectra. The setting for the time channels can be set either using the table or by setting a file; usually used when more than 6 regimes are required. The files are stored in the ``configurations/tcb`` directory in the settings on the instrument.

Return to `Contents`_.

Data Acquisition
~~~~~~~~~~~~~~~~

The data acquisition tab allows you to set up how the DAE will collect the data. The page is split into several sections:

Tables:
    The wiring table, detector table and spectra table set the files used when turning signals generated in the detectors into spectra. These files are stored in the ``configurations/tables`` directory in settings on the instrument.

Monitor:
    Set which spectra number is used for the monitor counts and between which times the spectra should be integrated to return the monitor counts.

Vetoes:
    Set which [[vetoes|KeyConceptsinIBEX#vetoes]] are active.

Muons:
    Set if and how to collect muon data.

Timing:
    Set the source of the [[timing signal|KeyConceptsinIBEX#dae-timing-sources]] and how often the data should be auto saved.

Return to `Contents`_.

Periods
~~~~~~~

The period tab allows the period types and needed parameters to be setup within the DAE. Periods allow data to be collected as if restarting the DAE but without the time overhead of doing this. Software periods are controlled via software command, e.g. genie_python's ``change_period`` command. The other options are Hardware controlled and these are internal (within the DAE) or external control. 

Return to `Contents`_.

Run Information
---------------

The Run Information Tab provides a more complete summary of the DAE setup than the Run Summary tab.  All the fields on this tab are read-only.

Return to `Contents`_.

Spectra Plots
-------------

The Spectra Plots Tab displays up to 4 spectra plots.  The plots show the recorded spectra from the detectors which were setup using the tables in the data acquisition tab.  You can choose which spectra are plotted by using the ``Spectrum:`` and ``Period:`` fields for each plot.  Click on the ``Set Plot`` button (positioned at the top right of each plot) to update the plot after changing the ``Spectrum:`` or ``Period:`` fields.


Return to `Contents`_.

Diagnostics
-----------

Intentionally left blank :-) .

Return to `Contents`_.

Vetoes
------

The Vetoes tab shows a summary of the vetoes that are in force and their effect for the current run.  This information is read-only.  Vetoes can only be changed prior to the start of a run, via the `Data Acquisition`_ sub-tab on the `Experiment Setup`_ tab.

Return to `Contents`_.
